

(:domain horse

	// Constants
	(:constants Horse_Constants
		(idle_wait_time_min 5.0)
		(idle_wait_time_max 10.0)
	)

	// True if the current time is lower than equal ?inp_timestamp + ?inp_tolerance.
	(:axiom (is_recent ?inp_timestamp ?inp_tolerance)
		(and (agent_time ?current_time)
			 (call lt (call add ?inp_timestamp ?inp_tolerance) ?current_time)
		)
	)

	// Entry point to call from C++ for the planner, this is consider the main behave function for
	// an AIIndividual.
	(:method (entry_point)

		// Self-preservation branch, flee from a disturbance.
		( branch_flee_from_disturbance if the disturbance level is 2
			(and (disturbance ?any_timestamp ?disturbance_type ?any_position)
				 (disturbance_level 2 ?disturbance_type ?any_position)
			)
			(    (do_flee_from_disturbance ?disturbance_type)
			)
		)

		// Do disturbance reaction if we had a disturbance in the last second.
		( branch_react_to_disturbance
			(and (disturbance ?timestamp ?disturbance_type ?disturbance_position)
				 (#is_recent ?timestamp 1.0)
			)
			( 	 (!begin_plan begin_react_to_disturbance)
				 (react_to_disturbance ?timestamp ?disturbance_type ?disturbance_position)
				 (!end_plan)
			)
		)
	)


	// react to disturbance method
	(:method (react_to_disturbance ?timestamp ?disturbance_type ?disturbance_position)

		( branch_first_time
			(and (not (disturbance_level ?any_level ?any_type ?any_position))
			)
			( 
				 (!remember - disturbance_level 1 ?disturbance_type ?disturbance_position)
				 (!look_at_disturbance ?disturbance_position)
			)
		)

		( branch_default
			(and (disturbance_level ?any_level ?any_type ?any_position) // not really needed
			)
			( 
				 (!remember - disturbance_level 2 ?disturbance_type ?disturbance_position)
				 (!wait_lower_body 0.5)
			)
		)
	)
)


